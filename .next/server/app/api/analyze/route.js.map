{"version":3,"file":"app/api/analyze/route.js","mappings":"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","sources":["webpack://_N_E/./server/promptTemplates.ts","webpack://_N_E/./server/score.ts","webpack://_N_E/./app/api/analyze/route.ts","webpack://_N_E/./app/api/analyze/route.ts?1fa3","webpack://_N_E/?13b2","webpack://_N_E/external commonjs \"node:buffer\"","webpack://_N_E/external commonjs \"node:async_hooks\"","webpack://_N_E/","webpack://_N_E/?ba49"],"sourcesContent":["export const researchPrompt = ({ role, tasks, resume }: any) => `\nYou are an AI researcher conducting a comprehensive analysis of AI automation risk for the role: ${role}.\n\n**ROLE CONTEXT:**\n- Position: ${role}\n- Weekly task breakdown: ${JSON.stringify(tasks)}\n- Professional background: ${resume?.slice(0, 800)}\n\n**RESEARCH REQUIREMENTS:**\nFor each major task category, provide:\n1. **Risk Assessment**: High (actively being automated) | Moderate (tools emerging) | Low (human-centric)\n2. **Evidence**: Specific AI tools, companies, or research directly relevant to this task\n3. **Timeline**: When automation might significantly impact this task\n4. **Source URLs**: Verifiable links to recent developments (2023-2024 preferred)\n\n**OUTPUT FORMAT:**\nReturn ONLY valid JSON in this exact structure:\n{\n  \"taskFacts\": [\n    {\n      \"task\": \"specific task name\",\n      \"riskLevel\": \"High|Moderate|Low\", \n      \"evidence\": \"detailed description of AI tools/developments affecting this task\",\n      \"impact\": \"percentage or description of potential automation\",\n      \"timeline\": \"estimated timeframe for significant impact\",\n      \"sourceUrl\": \"verifiable URL\",\n      \"toolsExample\": \"specific AI tools/platforms mentioned\"\n    }\n  ],\n  \"macroStats\": [\n    {\n      \"statistic\": \"industry-wide AI adoption or job impact data\",\n      \"source\": \"research organization or credible publication\",\n      \"url\": \"source URL\",\n      \"year\": \"2023 or 2024\",\n      \"relevance\": \"how this relates to the specific role\"\n    }\n  ],\n  \"industryContext\": {\n    \"overview\": \"2-3 sentence summary of AI impact in this industry\",\n    \"keyTrends\": [\"trend1\", \"trend2\", \"trend3\"],\n    \"timeHorizon\": \"overall timeline for major disruption in this field\"\n  }\n}\n\nFocus on concrete, recent developments with credible sources. Avoid speculation.`;\n\nexport const analysisPrompt = (json: string) => `\nYou are an expert AI risk analyst generating a comprehensive career assessment report.\n\n**INPUT DATA:** ${json}\n\n**SCORING FORMULA:**\nCalculate risk score: S = Î£(task_hours Ã— risk_weight) / total_hours Ã— 100\n- High Risk = 1.0 weight\n- Moderate Risk = 0.6 weight  \n- Low Risk = 0.3 weight\n\n**OUTPUT REQUIREMENTS:**\nGenerate exactly two sections separated by \"---FULL_REPORT---\":\n\n**SECTION 1: PREVIEW (Maximum 200 words)**\nCreate a polished, professional preview with:\n- Opening statement about AI transformation in this field\n- 2-3 key findings from the analysis\n- Overall risk score calculation and interpretation\n- One actionable tip\n- Inline citations using [1], [2], etc.\n\n**SECTION 2: FULL REPORT (Comprehensive Markdown)**\nGenerate a detailed markdown report with these sections:\n\n## Executive Summary\nBrief overview of findings and risk level\n\n## Risk Score Breakdown\n**Overall Risk Score: [X]/100 ([Risk Level])**\n\n### Task-by-Task Analysis\nFor each task:\n- **Task Name** - Risk Level: High/Moderate/Low\n- Current AI capabilities and tools\n- Timeline for impact\n- Evidence and citations [1]\n\n## Timeline & Projections\n**Immediate (0-12 months):**\n- Specific developments expected\n\n**Medium-term (1-3 years):**\n- Major changes anticipated\n\n**Long-term (3-5 years):**\n- Potential transformation\n\n## Mitigation Strategies\n### High-Priority Actions\n1. **Skill Development**: Specific skills to learn\n2. **Career Positioning**: How to differentiate\n3. **Industry Adaptation**: Trends to monitor\n\n### Recommended Focus Areas\n- List of specific competencies to develop\n- Technologies to learn\n- Certifications to pursue\n\n## Market Intelligence\n- Industry adoption rates\n- Competitor analysis  \n- Investment trends in automation\n\n## Action Plan\n### Next 90 Days\n- Immediate steps to take\n\n### Next 6 Months  \n- Medium-term goals\n\n### Next 1-2 Years\n- Long-term positioning strategy\n\n## Sources & References\n[1] Source 1 description - URL\n[2] Source 2 description - URL\n[etc.]\n\n**FORMATTING GUIDELINES:**\n- Use proper markdown headers (##, ###)\n- Include bullet points and numbered lists\n- Bold important terms and metrics\n- Use inline citations [1], [2] throughout\n- Keep language professional but accessible\n- Include specific, actionable recommendations\n- If insufficient data: respond with \"INSUFFICIENT_DATA_FOR_ANALYSIS\"\n\nGenerate the complete analysis now:`;\n\nexport const linkedinPrompt = (profileData: string) => `\nYou are analyzing a LinkedIn profile to extract professional information for AI replacement risk assessment.\n\n**LINKEDIN PROFILE DATA:**\n${profileData}\n\n**EXTRACTION REQUIREMENTS:**\nExtract and structure the following information:\n\n{\n  \"personalInfo\": {\n    \"name\": \"full name\",\n    \"currentTitle\": \"current job title\",\n    \"company\": \"current company\",\n    \"location\": \"current location\"\n  },\n  \"experience\": {\n    \"yearsTotal\": \"total years of experience\",\n    \"currentRole\": {\n      \"title\": \"current position\",\n      \"company\": \"company name\", \n      \"duration\": \"time in current role\",\n      \"description\": \"role description and responsibilities\"\n    },\n    \"previousRoles\": [\n      {\n        \"title\": \"job title\",\n        \"company\": \"company name\",\n        \"duration\": \"time period\",\n        \"keyResponsibilities\": [\"responsibility1\", \"responsibility2\"]\n      }\n    ]\n  },\n  \"skills\": {\n    \"technical\": [\"technical skill 1\", \"technical skill 2\"],\n    \"soft\": [\"soft skill 1\", \"soft skill 2\"],\n    \"tools\": [\"tool 1\", \"tool 2\"],\n    \"certifications\": [\"cert 1\", \"cert 2\"]\n  },\n  \"education\": [\n    {\n      \"degree\": \"degree type\",\n      \"field\": \"field of study\", \n      \"institution\": \"school name\",\n      \"year\": \"graduation year\"\n    }\n  ],\n  \"dailyTasks\": \"inferred daily responsibilities based on current and recent roles\",\n  \"careerCategory\": \"best matching category: designer|product-manager|marketing|accounting|legal|other\",\n  \"companySize\": \"inferred company size: startup|small|medium|large\"\n}\n\nFocus on extracting concrete, specific information. If data is missing, mark as \"not_available\".`;\n\nexport const webBrowsePrompt = (linkedinUrl: string) => `\nBrowse this LinkedIn profile URL and extract comprehensive professional information: ${linkedinUrl}\n\nFocus on:\n1. Current job title and company\n2. Work experience and career progression  \n3. Skills and technical competencies\n4. Education and certifications\n5. Key responsibilities and achievements\n6. Industry and functional area\n\nReturn the extracted information in a structured format that can be used for AI replacement risk analysis.`; ","export function score(evidence: any): number {\n  if (!evidence || !evidence.taskFacts) {\n    return 0;\n  }\n\n  let totalScore = 0;\n  let totalHours = 0;\n\n  for (const task of evidence.taskFacts) {\n    const hours = task.hours || 1;\n    let weight = 0;\n\n    switch (task.riskRating) {\n      case 'High':\n        weight = 1;\n        break;\n      case 'Moderate':\n        weight = 0.6;\n        break;\n      case 'Low':\n        weight = 0.3;\n        break;\n      default:\n        weight = 0.5;\n    }\n\n    totalScore += hours * weight;\n    totalHours += hours;\n  }\n\n  if (totalHours === 0) {\n    return 0;\n  }\n\n  // Return as percentage (0-100)\n  return Math.round((totalScore / totalHours) * 100);\n} ","import { NextRequest, NextResponse } from 'next/server';\nimport { createClient } from '@supabase/supabase-js';\nimport OpenAI from 'openai';\nimport { analysisPrompt } from '@/server/promptTemplates';\nimport { score } from '@/server/score';\n\nexport const runtime = 'edge';\n\n// Function to sanitize text for database insertion\nfunction sanitizeText(text: string): string {\n  if (!text) return '';\n  \n  return text\n    // Remove null bytes and other problematic Unicode characters\n    .replace(/\\0/g, '')\n    // Normalize Unicode\n    .normalize('NFC')\n    // Limit length to prevent oversized content\n    .substring(0, 50000);\n}\n\nexport async function POST(req: NextRequest) {\n  console.log('ðŸ”¬ [Analyze API] Starting analysis request...');\n  \n  try {\n    const body = await req.json();\n    console.log('ðŸ“‹ [Analyze API] Request body keys:', Object.keys(body));\n    console.log('ðŸ“‹ [Analyze API] Profile ID:', body.profile_id);\n    console.log('ðŸ“‹ [Analyze API] Evidence type:', typeof body.evidence);\n    \n    const { profile_id, evidence } = body;\n\n    // Validate required fields\n    if (!profile_id) {\n      console.error('âŒ [Analyze API] Missing profile_id');\n      return NextResponse.json({ error: 'Profile ID is required' }, { status: 400 });\n    }\n\n    if (!evidence) {\n      console.error('âŒ [Analyze API] Missing evidence');\n      return NextResponse.json({ error: 'Evidence is required' }, { status: 400 });\n    }\n\n    console.log('ðŸ”— [Analyze API] Creating Supabase client...');\n    const supabase = createClient(\n      process.env.SUPABASE_URL!,\n      process.env.SUPABASE_SERVICE_ROLE_KEY!\n    );\n    console.log('âœ… [Analyze API] Supabase client created');\n\n    console.log('ðŸ¤– [Analyze API] Creating OpenAI client...');\n    const openai = new OpenAI({ \n      apiKey: process.env.OPENAI_API_KEY,\n      timeout: 60000 // 60 second timeout for analysis\n    });\n\n    console.log('ðŸ“ [Analyze API] Generating analysis prompt...');\n    const prompt = analysisPrompt(JSON.stringify(evidence));\n    console.log('ðŸ“„ [Analyze API] Prompt length:', prompt.length);\n\n    console.log('ðŸš€ [Analyze API] Calling OpenAI API (gpt-4o model)...');\n    // Use gpt-4o instead of o3 for now since o3 might not be available\n    const analysis = await openai.chat.completions.create({\n      model: 'gpt-4o',\n      temperature: 0,\n      messages: [{ role: 'system', content: prompt }]\n    });\n\n    console.log('âœ… [Analyze API] OpenAI response received');\n    console.log('ðŸ“Š [Analyze API] Response usage:', analysis.usage);\n\n    const responseContent = analysis.choices[0].message.content;\n    console.log('ðŸ“„ [Analyze API] Response content length:', responseContent?.length);\n\n    if (!responseContent) {\n      console.error('âŒ [Analyze API] Empty response from OpenAI');\n      return NextResponse.json({ error: 'Empty analysis response' }, { status: 500 });\n    }\n\n    console.log('ðŸ”§ [Analyze API] Splitting response into preview and full report...');\n    const [preview, full] = responseContent.split('---FULL_REPORT---');\n    console.log('ðŸ“„ [Analyze API] Preview length:', preview?.length);\n    console.log('ðŸ“„ [Analyze API] Full report length:', full?.length);\n\n    // Sanitize the text outputs\n    const sanitizedPreview = sanitizeText(preview?.trim() || 'Analysis preview not available');\n    const sanitizedFullReport = sanitizeText(full?.trim() || 'Full report not available');\n\n    console.log('ðŸ§® [Analyze API] Calculating risk score...');\n    const scoreVal = score(evidence);\n    console.log('ðŸ“Š [Analyze API] Calculated score:', scoreVal);\n\n    console.log('ðŸ’¾ [Analyze API] Saving report to database...');\n    const { data: report, error: dbError } = await supabase\n      .from('reports')\n      .insert([{\n        profile_id,\n        score: scoreVal,\n        preview: sanitizedPreview,\n        full_report: sanitizedFullReport,\n        evidence: evidence\n      }])\n      .select()\n      .single();\n\n    if (dbError) {\n      console.error('âŒ [Analyze API] Database error:', dbError);\n      return NextResponse.json({ error: 'Database error: ' + dbError.message }, { status: 500 });\n    }\n\n    console.log('âœ… [Analyze API] Report saved successfully:', report?.id);\n    console.log('âœ… [Analyze API] Analysis completed successfully');\n\n    return NextResponse.json({ ok: true, report_id: report?.id });\n\n  } catch (error) {\n    console.error('ðŸ’¥ [Analyze API] Unexpected error:', error);\n    console.error('ðŸ“š [Analyze API] Error stack:', error instanceof Error ? error.stack : 'No stack trace');\n    return NextResponse.json(\n      { error: 'Analysis failed: ' + (error instanceof Error ? error.message : String(error)) }, \n      { status: 500 }\n    );\n  }\n} ","import { AppRouteRouteModule } from \"next/dist/server/route-modules/app-route/module.compiled\";\nimport { RouteKind } from \"next/dist/server/route-kind\";\nimport { patchFetch as _patchFetch } from \"next/dist/server/lib/patch-fetch\";\nimport * as userland from \"/Users/miguel/Downloads/AICareerShield/app/api/analyze/route.ts\";\n// We inject the nextConfigOutput here so that we can use them in the route\n// module.\nconst nextConfigOutput = \"\"\nconst routeModule = new AppRouteRouteModule({\n    definition: {\n        kind: RouteKind.APP_ROUTE,\n        page: \"/api/analyze/route\",\n        pathname: \"/api/analyze\",\n        filename: \"route\",\n        bundlePath: \"app/api/analyze/route\"\n    },\n    resolvedPagePath: \"/Users/miguel/Downloads/AICareerShield/app/api/analyze/route.ts\",\n    nextConfigOutput,\n    userland\n});\n// Pull out the exports that we need to expose from the module. This should\n// be eliminated when we've moved the other routes to the new format. These\n// are used to hook into the route.\nconst { workAsyncStorage, workUnitAsyncStorage, serverHooks } = routeModule;\nfunction patchFetch() {\n    return _patchFetch({\n        workAsyncStorage,\n        workUnitAsyncStorage\n    });\n}\nexport { routeModule, workAsyncStorage, workUnitAsyncStorage, serverHooks, patchFetch,  };\n\n//# sourceMappingURL=app-route.js.map","var _self___RSC_MANIFEST;\nimport { createServerModuleMap } from \"next/dist/server/app-render/action-utils\";\nimport { setReferenceManifestsSingleton } from \"next/dist/server/app-render/encryption-utils\";\nimport { EdgeRouteModuleWrapper } from \"next/dist/server/web/edge-route-module-wrapper\";\n// Import the userland code.\nimport * as module from \"next-app-loader?name=app%2Fapi%2Fanalyze%2Froute&page=%2Fapi%2Fanalyze%2Froute&pagePath=private-next-app-dir%2Fapi%2Fanalyze%2Froute.ts&appDir=%2FUsers%2Fmiguel%2FDownloads%2FAICareerShield%2Fapp&appPaths=%2Fapi%2Fanalyze%2Froute&pageExtensions=tsx&pageExtensions=ts&pageExtensions=jsx&pageExtensions=js&basePath=&assetPrefix=&nextConfigOutput=&preferredRegion=&middlewareConfig=e30%3D!private-next-app-dir/api/analyze/route.ts?__next_edge_ssr_entry__\";\nconst nextConfig = {\"env\":{},\"webpack\":null,\"eslint\":{\"ignoreDuringBuilds\":false},\"typescript\":{\"ignoreBuildErrors\":false,\"tsconfigPath\":\"tsconfig.json\"},\"distDir\":\".next\",\"cleanDistDir\":true,\"assetPrefix\":\"\",\"cacheMaxMemorySize\":52428800,\"configOrigin\":\"next.config.js\",\"useFileSystemPublicRoutes\":true,\"generateEtags\":true,\"pageExtensions\":[\"tsx\",\"ts\",\"jsx\",\"js\"],\"poweredByHeader\":true,\"compress\":true,\"images\":{\"deviceSizes\":[640,750,828,1080,1200,1920,2048,3840],\"imageSizes\":[16,32,48,64,96,128,256,384],\"path\":\"/_next/image\",\"loader\":\"default\",\"loaderFile\":\"\",\"domains\":[],\"disableStaticImages\":false,\"minimumCacheTTL\":60,\"formats\":[\"image/webp\"],\"dangerouslyAllowSVG\":false,\"contentSecurityPolicy\":\"script-src 'none'; frame-src 'none'; sandbox;\",\"contentDispositionType\":\"attachment\",\"remotePatterns\":[],\"unoptimized\":false},\"devIndicators\":{\"position\":\"bottom-left\"},\"onDemandEntries\":{\"maxInactiveAge\":60000,\"pagesBufferLength\":5},\"amp\":{\"canonicalBase\":\"\"},\"basePath\":\"\",\"sassOptions\":{},\"trailingSlash\":false,\"i18n\":null,\"productionBrowserSourceMaps\":false,\"excludeDefaultMomentLocales\":true,\"serverRuntimeConfig\":{},\"publicRuntimeConfig\":{},\"reactProductionProfiling\":false,\"reactStrictMode\":null,\"reactMaxHeadersLength\":6000,\"httpAgentOptions\":{\"keepAlive\":true},\"logging\":{},\"expireTime\":31536000,\"staticPageGenerationTimeout\":60,\"modularizeImports\":{\"@mui/icons-material\":{\"transform\":\"@mui/icons-material/{{member}}\"},\"lodash\":{\"transform\":\"lodash/{{member}}\"}},\"outputFileTracingRoot\":\"/Users/miguel/Downloads/AICareerShield\",\"experimental\":{\"nodeMiddleware\":false,\"cacheLife\":{\"default\":{\"stale\":300,\"revalidate\":900,\"expire\":4294967294},\"seconds\":{\"stale\":0,\"revalidate\":1,\"expire\":60},\"minutes\":{\"stale\":300,\"revalidate\":60,\"expire\":3600},\"hours\":{\"stale\":300,\"revalidate\":3600,\"expire\":86400},\"days\":{\"stale\":300,\"revalidate\":86400,\"expire\":604800},\"weeks\":{\"stale\":300,\"revalidate\":604800,\"expire\":2592000},\"max\":{\"stale\":300,\"revalidate\":2592000,\"expire\":4294967294}},\"cacheHandlers\":{},\"cssChunking\":true,\"multiZoneDraftMode\":false,\"appNavFailHandling\":false,\"prerenderEarlyExit\":true,\"serverMinification\":true,\"serverSourceMaps\":false,\"linkNoTouchStart\":false,\"caseSensitiveRoutes\":false,\"clientSegmentCache\":false,\"dynamicOnHover\":false,\"preloadEntriesOnStart\":true,\"clientRouterFilter\":true,\"clientRouterFilterRedirects\":false,\"fetchCacheKeyPrefix\":\"\",\"middlewarePrefetch\":\"flexible\",\"optimisticClientCache\":true,\"manualClientBasePath\":false,\"cpus\":13,\"memoryBasedWorkersCount\":false,\"imgOptConcurrency\":null,\"imgOptTimeoutInSeconds\":7,\"imgOptMaxInputPixels\":268402689,\"imgOptSequentialRead\":null,\"isrFlushToDisk\":true,\"workerThreads\":false,\"optimizeCss\":false,\"nextScriptWorkers\":false,\"scrollRestoration\":false,\"externalDir\":false,\"disableOptimizedLoading\":false,\"gzipSize\":true,\"craCompat\":false,\"esmExternals\":true,\"fullySpecified\":false,\"swcTraceProfiling\":false,\"forceSwcTransforms\":false,\"largePageDataBytes\":128000,\"typedRoutes\":false,\"typedEnv\":false,\"parallelServerCompiles\":false,\"parallelServerBuildTraces\":false,\"ppr\":false,\"authInterrupts\":false,\"webpackMemoryOptimizations\":false,\"optimizeServerReact\":true,\"useEarlyImport\":false,\"viewTransition\":false,\"routerBFCache\":false,\"staleTimes\":{\"dynamic\":0,\"static\":300},\"serverComponentsHmrCache\":true,\"staticGenerationMaxConcurrency\":8,\"staticGenerationMinPagesPerWorker\":25,\"dynamicIO\":false,\"inlineCss\":false,\"useCache\":false,\"optimizePackageImports\":[\"lucide-react\",\"date-fns\",\"lodash-es\",\"ramda\",\"antd\",\"react-bootstrap\",\"ahooks\",\"@ant-design/icons\",\"@headlessui/react\",\"@headlessui-float/react\",\"@heroicons/react/20/solid\",\"@heroicons/react/24/solid\",\"@heroicons/react/24/outline\",\"@visx/visx\",\"@tremor/react\",\"rxjs\",\"@mui/material\",\"@mui/icons-material\",\"recharts\",\"react-use\",\"effect\",\"@effect/schema\",\"@effect/platform\",\"@effect/platform-node\",\"@effect/platform-browser\",\"@effect/platform-bun\",\"@effect/sql\",\"@effect/sql-mssql\",\"@effect/sql-mysql2\",\"@effect/sql-pg\",\"@effect/sql-squlite-node\",\"@effect/sql-squlite-bun\",\"@effect/sql-squlite-wasm\",\"@effect/sql-squlite-react-native\",\"@effect/rpc\",\"@effect/rpc-http\",\"@effect/typeclass\",\"@effect/experimental\",\"@effect/opentelemetry\",\"@material-ui/core\",\"@material-ui/icons\",\"@tabler/icons-react\",\"mui-core\",\"react-icons/ai\",\"react-icons/bi\",\"react-icons/bs\",\"react-icons/cg\",\"react-icons/ci\",\"react-icons/di\",\"react-icons/fa\",\"react-icons/fa6\",\"react-icons/fc\",\"react-icons/fi\",\"react-icons/gi\",\"react-icons/go\",\"react-icons/gr\",\"react-icons/hi\",\"react-icons/hi2\",\"react-icons/im\",\"react-icons/io\",\"react-icons/io5\",\"react-icons/lia\",\"react-icons/lib\",\"react-icons/lu\",\"react-icons/md\",\"react-icons/pi\",\"react-icons/ri\",\"react-icons/rx\",\"react-icons/si\",\"react-icons/sl\",\"react-icons/tb\",\"react-icons/tfi\",\"react-icons/ti\",\"react-icons/vsc\",\"react-icons/wi\"]},\"htmlLimitedBots\":\"Mediapartners-Google|Slurp|DuckDuckBot|baiduspider|yandex|sogou|bitlybot|tumblr|vkShare|quora link preview|redditbot|ia_archiver|Bingbot|BingPreview|applebot|facebookexternalhit|facebookcatalog|Twitterbot|LinkedInBot|Slackbot|Discordbot|WhatsApp|SkypeUriPreview|Yeti\",\"bundlePagesRouterDependencies\":false,\"configFile\":\"/Users/miguel/Downloads/AICareerShield/next.config.js\",\"configFileName\":\"next.config.js\",\"serverExternalPackages\":[\"pdf-parse\"],\"turbopack\":{\"root\":\"/Users/miguel/Downloads/AICareerShield\"}}\nconst maybeJSONParse = (str)=>str ? JSON.parse(str) : undefined;\nconst rscManifest = (_self___RSC_MANIFEST = self.__RSC_MANIFEST) == null ? void 0 : _self___RSC_MANIFEST[\"/api/analyze/route\"];\nconst rscServerManifest = maybeJSONParse(self.__RSC_SERVER_MANIFEST);\nif (rscManifest && rscServerManifest) {\n    setReferenceManifestsSingleton({\n        page: \"/api/analyze/route\",\n        clientReferenceManifest: rscManifest,\n        serverActionsManifest: rscServerManifest,\n        serverModuleMap: createServerModuleMap({\n            serverActionsManifest: rscServerManifest\n        })\n    });\n}\nexport const ComponentMod = module;\nexport default EdgeRouteModuleWrapper.wrap(module.routeModule, {\n    nextConfig\n});\n\n//# sourceMappingURL=edge-app-route.js.map","module.exports = require(\"node:buffer\");","module.exports = require(\"node:async_hooks\");"],"names":["researchPrompt","role","tasks","resume","JSON","stringify","slice","json","runtime","sanitizeText","text","normalize","substring","POST","req","console","log","body","Object","keys","profile_id","evidence","error","NextResponse","status","supabase","createClient","process","env","SUPABASE_URL","SUPABASE_SERVICE_ROLE_KEY","openai","OpenAI","apiKey","OPENAI_API_KEY","timeout","prompt","analysisPrompt","length","analysis","chat","completions","create","model","temperature","messages","content","usage","responseContent","choices","message","preview","full","split","sanitizedPreview","trim","sanitizedFullReport","scoreVal","score","taskFacts","totalScore","totalHours","task","hours","weight","riskRating","Math","round","data","report","dbError","from","insert","full_report","select","single","id","ok","report_id","Error","stack","String"],"sourceRoot":"","ignoreList":[]}