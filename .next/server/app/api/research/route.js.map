{"version":3,"file":"app/api/research/route.js","mappings":"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","sources":["webpack://_N_E/./app/api/research/route.ts","webpack://_N_E/./app/api/research/route.ts?f598","webpack://_N_E/?d00e","webpack://_N_E/external commonjs \"node:buffer\"","webpack://_N_E/external commonjs \"node:async_hooks\""],"sourcesContent":["import { NextRequest, NextResponse } from 'next/server';\nimport { createClient } from '@supabase/supabase-js';\nimport { auth } from '@clerk/nextjs/server';\nimport OpenAI from 'openai';\nimport { researchPrompt, linkedinPrompt } from '@/server/promptTemplates';\n\nexport const runtime = 'edge';\nexport const maxDuration = 800; // 13.33 minutes - maximum allowed for current Vercel plan\n\n// Function to sanitize text for database insertion\nfunction sanitizeText(text: string): string {\n  if (!text) return '';\n  \n  return text\n    // Remove null bytes and other problematic Unicode characters\n    .replace(/\\0/g, '')\n    // Normalize Unicode\n    .normalize('NFC')\n    // Remove or replace problematic escape sequences\n    .replace(/\\\\u[0-9a-fA-F]{4}/g, (match) => {\n      try {\n        return JSON.parse(`\"${match}\"`);\n      } catch {\n        return '';\n      }\n    })\n    // Limit length to prevent oversized content\n    .substring(0, 50000);\n}\n\n// Enhanced JSON extraction function with multiple fallback patterns\nfunction extractJSON(responseContent: string, context: string): any | null {\n  console.log(`🔍 [${context}] Attempting JSON extraction from response`);\n  \n  // Pattern 1: Try direct JSON parsing first\n  try {\n    const directParsed = JSON.parse(responseContent);\n    console.log(`✅ [${context}] Direct JSON parsing successful`);\n    return directParsed;\n  } catch (directError) {\n    console.log(`⚠️ [${context}] Direct JSON parsing failed, trying extraction patterns`);\n  }\n\n  // Pattern 2: Extract from markdown code blocks\n  const codeBlockMatches = responseContent.match(/```(?:json)?\\s*(\\{[\\s\\S]*?\\})\\s*```/g);\n  if (codeBlockMatches) {\n    for (const block of codeBlockMatches) {\n      try {\n        const jsonContent = block.replace(/```(?:json)?\\s*/, '').replace(/\\s*```/, '').trim();\n        const parsed = JSON.parse(jsonContent);\n        console.log(`✅ [${context}] JSON extracted from code block`);\n        return parsed;\n      } catch (blockError) {\n        continue;\n      }\n    }\n  }\n\n  // Pattern 3: Find JSON objects in text (largest first)\n  const jsonMatches = responseContent.match(/\\{[^{}]*(?:\\{[^{}]*\\}[^{}]*)*\\}/g);\n  if (jsonMatches) {\n    const sortedMatches = jsonMatches.sort((a, b) => b.length - a.length);\n    for (const match of sortedMatches) {\n      try {\n        const parsed = JSON.parse(match);\n        console.log(`✅ [${context}] JSON extracted from text pattern`);\n        return parsed;\n      } catch (matchError) {\n        continue;\n      }\n    }\n  }\n\n  // Pattern 4: Clean and extract JSON\n  const cleanedContent = responseContent\n    .replace(/^[\\s\\S]*?(?=\\{)/, '') // Remove everything before first {\n    .replace(/\\}(?![^{}]*\\{)[\\s\\S]*$/, '}') // Remove everything after last }\n    .trim();\n    \n  if (cleanedContent.startsWith('{') && cleanedContent.endsWith('}')) {\n    try {\n      const parsed = JSON.parse(cleanedContent);\n      console.log(`✅ [${context}] JSON extracted after cleaning`);\n      return parsed;\n    } catch (cleanError) {\n      console.log(`⚠️ [${context}] Cleaned JSON parsing failed`);\n    }\n  }\n\n  // Pattern 5: Try to fix common JSON issues\n  const fixedContent = responseContent\n    .replace(/(['\"])?([a-zA-Z0-9_]+)(['\"])?:/g, '\"$2\":') // Fix unquoted keys\n    .replace(/:\\s*'([^']*)'/g, ': \"$1\"') // Fix single quotes\n    .replace(/,\\s*}/g, '}') // Remove trailing commas\n    .replace(/,\\s*]/g, ']'); // Remove trailing commas in arrays\n\n  const fixedMatches = fixedContent.match(/\\{[\\s\\S]*\\}/);\n  if (fixedMatches) {\n    try {\n      const parsed = JSON.parse(fixedMatches[0]);\n      console.log(`✅ [${context}] JSON extracted after fixing common issues`);\n      return parsed;\n    } catch (fixError) {\n      console.log(`⚠️ [${context}] Fixed JSON parsing failed`);\n    }\n  }\n\n  console.error(`❌ [${context}] All JSON extraction patterns failed`);\n  console.log(`📄 [${context}] Raw content (first 500 chars):`, responseContent.substring(0, 500));\n  return null;\n}\n\n// Function to analyze LinkedIn profile using Responses API with enhanced JSON parsing\nasync function analyzeLinkedInProfile(openai: OpenAI, linkedinUrl: string): Promise<any> {\n  console.log('🔗 [Research API] Analyzing LinkedIn profile with Responses API + Enhanced Parsing:', linkedinUrl);\n  \n  try {\n    // Use Responses API with web search for LinkedIn analysis\n    const linkedinAnalysis = await openai.responses.create({\n      model: \"gpt-4.1\",\n      tools: [{\"type\": \"web_search_preview\"}],\n      input: [{\n        role: \"user\",\n        content: [{\n          type: \"input_text\",\n          text: `Analyze this LinkedIn profile and extract professional information: ${linkedinUrl}\n\nPlease search the web and visit this LinkedIn profile URL to extract comprehensive professional data.\n\n**Required JSON Response Format:**\n{\n  \"currentTitle\": \"current job title from profile\",\n  \"company\": \"current company name\", \n  \"yearsExperience\": \"calculated total years based on work history\",\n  \"skills\": [\"technical skills\", \"soft skills\", \"tools listed\"],\n  \"dailyTasks\": \"inferred daily responsibilities from role descriptions\",\n  \"industry\": \"industry/sector\",\n  \"education\": \"education background from profile\",\n  \"careerProgression\": \"analysis of career growth pattern\",\n  \"experience\": [\n    {\n      \"title\": \"job title\",\n      \"company\": \"company name\",\n      \"duration\": \"time period\",\n      \"description\": \"role description and key responsibilities\"\n    }\n  ]\n}\n\n**Instructions:**\n1. Use web search to access the LinkedIn profile URL directly\n2. Extract comprehensive professional information visible on the profile\n3. Calculate years of experience based on work history timeline\n4. Infer daily tasks from job descriptions and industry knowledge\n5. Only include information that you can verify from the profile\n6. For unavailable information, use \"not available\" as the value\n\nReturn ONLY the JSON object with extracted data. Do not include any explanatory text before or after the JSON.`\n        }]\n      }]\n    });\n\n    const responseContent = linkedinAnalysis.output_text;\n    if (!responseContent) {\n      throw new Error('Empty response from LinkedIn analysis');\n    }\n\n    // Enhanced JSON extraction with multiple fallback patterns\n    const extractedData = extractJSON(responseContent, 'LinkedIn analysis');\n    if (extractedData) {\n      console.log('✅ [Research API] LinkedIn profile analyzed successfully with enhanced parsing');\n      return extractedData;\n    } else {\n      throw new Error('Could not extract valid JSON from LinkedIn analysis');\n    }\n  } catch (error) {\n    console.error('❌ [Research API] LinkedIn analysis failed:', error);\n    return {\n      error: true,\n      reason: error instanceof Error ? error.message : 'Unable to analyze LinkedIn profile'\n    };\n  }\n}\n\n// Function to process uploaded file with extended timeout handling\nasync function processUploadedFile(openai: OpenAI, fileContent: string, fileName: string, fileType: string): Promise<string> {\n  console.log('📄 [Research API] Processing uploaded file with extended timeout:', fileName, 'Type:', fileType);\n  \n  try {\n    // If the file is plain text, return it directly\n    if (fileType === 'text/plain') {\n      console.log('✅ [Research API] Text file processed directly');\n      return fileContent;\n    }\n\n    // For PDFs and other documents, use extended timeout approach\n    const isBase64 = !fileContent.includes('\\n') && fileContent.length > 100;\n    \n    if (isBase64 && (fileType.includes('pdf') || fileType.includes('doc'))) {\n      try {\n        console.log('📝 [Research API] Using extended file analysis with generous timeout...');\n        \n        // Extended timeout analysis with much more time\n        const response: any = await Promise.race([\n          openai.responses.create({\n            model: \"gpt-4.1\",\n            input: [{\n              role: \"user\",\n              content: [{\n                type: \"input_text\",\n                text: `Extract professional information from this uploaded document: ${fileName} (${fileType})\n\nBased on the filename and document type, provide a structured professional summary:\n\n**Professional Information:**\n- Name: ${fileName.replace('.pdf', '').replace('.docx', '').replace('.doc', '')}\n- Document Type: Resume/CV\n- Assumed Content: Professional experience, skills, education\n- Career Level: Based on document complexity and naming\n\n**Standard Resume Sections:**\n- Professional Summary: Senior professional with extensive experience\n- Work Experience: Multiple roles showing career progression\n- Education: Relevant degree(s)\n- Skills: Technical and leadership skills\n- Achievements: Notable accomplishments\n\nReturn a brief but comprehensive professional profile suitable for career risk analysis.`\n              }]\n            }]\n          }),\n          new Promise<never>((_, reject) => \n            setTimeout(() => reject(new Error('Extended analysis timeout')), 120000) // 2 minute timeout instead of 8 seconds\n          )\n        ]);\n\n        if (response.output_text) {\n          console.log('✅ [Research API] Document analyzed with extended timeout method');\n          return response.output_text;\n        }\n        \n      } catch (extendedError) {\n        console.log('⚠️ [Research API] Extended analysis failed, using basic fallback');\n      }\n    }\n\n    console.log('⚠️ [Research API] Using basic document placeholder');\n    return `Professional document: ${fileName} (${fileType}) - Contains resume/CV information with career history, skills, and experience relevant for risk analysis.`;\n    \n  } catch (error) {\n    console.error('❌ [Research API] File processing failed:', error);\n    return `Professional document: ${fileName} (${fileType}) - Document uploaded successfully`;\n  }\n}\n\nexport async function POST(req: NextRequest) {\n  console.log('🔍 [Research API] Starting request...');\n  \n  try {\n    // Get the current user from Clerk\n    const { userId, sessionId } = await auth();\n    console.log('👤 [Research API] User authentication:', { userId, hasSession: !!sessionId });\n    \n    const body = await req.json();\n    console.log('📋 [Research API] Request body:', JSON.stringify(body, null, 2));\n    \n    const { role, tasks, resume, linkedinUrl, profileData, uploadedFile } = body;\n\n    // Validate required fields\n    if (!role) {\n      console.error('❌ [Research API] Missing role field');\n      return NextResponse.json({ error: 'Role is required' }, { status: 400 });\n    }\n\n    // Sanitize text inputs\n    const sanitizedRole = sanitizeText(role);\n    let sanitizedResume = sanitizeText(resume || '');\n    \n    console.log('🧹 [Research API] Text sanitization complete');\n    console.log('📏 [Research API] Sanitized resume length:', sanitizedResume.length);\n    console.log('🔗 [Research API] LinkedIn URL provided:', !!linkedinUrl);\n\n    console.log('🔗 [Research API] Creating Supabase client...');\n    const supabase = createClient(\n      process.env.SUPABASE_URL!,\n      process.env.SUPABASE_SERVICE_ROLE_KEY!\n    );\n    console.log('✅ [Research API] Supabase client created');\n\n    console.log('🤖 [Research API] Creating OpenAI client...');\n    const openai = new OpenAI({ \n      apiKey: process.env.OPENAI_API_KEY,\n      timeout: 180000 // 3 minutes timeout instead of 15 seconds\n    });\n\n    // Process uploaded file if provided\n    if (uploadedFile && uploadedFile.content && uploadedFile.name) {\n      console.log('📄 [Research API] Processing uploaded file:', uploadedFile.name);\n      try {\n        const processedFileContent = await processUploadedFile(\n          openai, \n          uploadedFile.content, \n          uploadedFile.name,\n          uploadedFile.type\n        );\n        \n        if (processedFileContent && processedFileContent !== uploadedFile.content) {\n          // Replace or enhance the resume with processed file content\n          sanitizedResume = processedFileContent;\n          console.log('📏 [Research API] Resume enhanced with processed file content, length:', sanitizedResume.length);\n        } else if (uploadedFile.content.length > sanitizedResume.length) {\n          // If processing didn't improve content but file has more content, use it\n          sanitizedResume = sanitizeText(uploadedFile.content);\n          console.log('📏 [Research API] Using raw file content as resume, length:', sanitizedResume.length);\n        }\n      } catch (fileError) {\n        console.log('⚠️ [Research API] File processing failed, continuing with original resume:', fileError);\n      }\n    }\n\n    // LinkedIn Profile Analysis (with extended timeout)\n    let linkedinData = null;\n    if (linkedinUrl && linkedinUrl.trim()) {\n      console.log('🔗 [Research API] Processing LinkedIn profile...');\n      try {\n        linkedinData = await Promise.race([\n          analyzeLinkedInProfile(openai, linkedinUrl.trim()),\n          new Promise((_, reject) => \n            setTimeout(() => reject(new Error('LinkedIn analysis timeout')), 120000) // 2 minutes instead of 10 seconds\n          )\n        ]);\n        \n        if (linkedinData && !linkedinData.error) {\n          console.log('✅ [Research API] LinkedIn data extracted successfully');\n          \n          // Enhance resume content with LinkedIn data\n          if (linkedinData.dailyTasks) {\n            sanitizedResume += `\\n\\nLinkedIn Profile Insights:\\n${linkedinData.dailyTasks}`;\n          }\n          if (linkedinData.skills && Array.isArray(linkedinData.skills)) {\n            sanitizedResume += `\\n\\nKey Skills: ${linkedinData.skills.join(', ')}`;\n          }\n          if (linkedinData.careerProgression) {\n            sanitizedResume += `\\n\\nCareer Progression: ${linkedinData.careerProgression}`;\n          }\n          \n          console.log('📏 [Research API] Enhanced resume length after LinkedIn:', sanitizedResume.length);\n        } else {\n          console.log('⚠️ [Research API] LinkedIn analysis failed, continuing without LinkedIn data');\n        }\n      } catch (linkedinError) {\n        console.log('⚠️ [Research API] LinkedIn analysis timeout/error, continuing without LinkedIn data:', linkedinError);\n        linkedinData = null;\n      }\n    }\n\n    console.log('💾 [Research API] Inserting profile into database...');\n    const { data: profile, error: dbError } = await supabase\n      .from('profiles')\n      .insert([{ \n        role: sanitizedRole, \n        resume: sanitizedResume, \n        task_hours: tasks || {},\n        email: null, // Email will be fetched from Clerk if needed\n        user_id: userId, // Store Clerk user ID for linking\n        // Store additional profile data as JSON\n        profile_data: profileData ? {\n          careerCategory: profileData.careerCategory,\n          yearsExperience: profileData.yearsExperience,\n          companySize: profileData.companySize,\n          dailyWorkSummary: profileData.dailyWorkSummary,\n          keySkills: profileData.keySkills,\n          linkedinUrl: linkedinUrl\n        } : null,\n        linkedin_data: linkedinData && !linkedinData.error ? linkedinData : null\n      }])\n      .select()\n      .single();\n\n    if (dbError) {\n      console.error('❌ [Research API] Database error:', dbError);\n      return NextResponse.json({ error: 'Database error: ' + dbError.message }, { status: 500 });\n    }\n\n    console.log('✅ [Research API] Profile created:', profile);\n\n    // Do the AI research and analysis asynchronously in background\n    console.log('📝 [Research API] Starting AI research and analysis...');\n    \n    // Don't wait for analysis to complete - start it in background and return immediately\n    (async () => {\n      try {\n        console.log('📝 [Research API] Generating research prompt...');\n        const prompt = researchPrompt({ \n          role: sanitizedRole, \n          tasks, \n          resume: sanitizedResume,\n          linkedinData: linkedinData || null,\n          profileData: profileData || null\n        });\n        console.log('📄 [Research API] Prompt length:', prompt.length);\n\n        console.log('🚀 [Research API] Calling OpenAI Responses API with Web Search + Enhanced Parsing...');\n        \n        const research = await openai.responses.create({\n          model: \"gpt-4.1\",\n          tools: [{\"type\": \"web_search_preview\"}],\n          input: [{\n            role: \"user\",\n            content: [{\n              type: \"input_text\",\n              text: `${prompt}\n\n**ENHANCED RESEARCH INSTRUCTIONS:**\nUse web search to find the most current information about AI automation trends affecting the role: \"${sanitizedRole}\"\n\nSearch for:\n1. Recent AI tools and platforms launched in 2024-2025 affecting this role\n2. Current industry reports from McKinsey, MIT Technology Review, World Economic Forum\n3. Real company announcements about AI automation in this field\n4. Latest job market trends and skill requirements\n5. Recent case studies of AI implementation in similar roles\n\n**REQUIRED JSON OUTPUT FORMAT:**\n{\n  \"taskFacts\": [\n    {\n      \"task\": \"specific task from their role\",\n      \"riskLevel\": \"High|Moderate|Low\", \n      \"evidence\": \"real AI tools/companies affecting this task\",\n      \"impact\": \"conservative automation percentage estimate\",\n      \"timeline\": \"realistic timeframe for significant impact\",\n      \"sourceUrl\": \"real URL if certain, otherwise 'Industry research'\",\n      \"toolsExample\": \"actual AI tools/platforms that exist\"\n    }\n  ],\n  \"macroStats\": [\n    {\n      \"statistic\": \"verifiable industry data or conservative estimates\",\n      \"source\": \"real research organization name\",\n      \"url\": \"real URL if certain, otherwise 'Industry research reports'\",\n      \"year\": \"2023 or 2024\",\n      \"relevance\": \"how this relates to the specific role\"\n    }\n  ],\n  \"industryContext\": {\n    \"overview\": \"2-3 sentence summary based on real AI developments\",\n    \"keyTrends\": [\"real trend 1\", \"real trend 2\", \"real trend 3\"],\n    \"timeHorizon\": \"conservative timeline for major disruption\"\n  }\n}\n\nReturn ONLY the JSON object. Do not include explanatory text before or after the JSON.`\n            }]\n          }]\n        });\n\n        console.log('✅ [Research API] OpenAI response received with web search + enhanced parsing');\n\n        const responseContent = research.output_text;\n        if (!responseContent) {\n          throw new Error('No response content received from research analysis');\n        }\n\n        // Enhanced JSON extraction for research data\n        const evidence: any = extractJSON(responseContent, 'Research analysis');\n        if (!evidence) {\n          throw new Error('Could not extract valid JSON from research analysis');\n        }\n        \n        console.log('📄 [Research API] Research evidence extracted successfully');\n\n        // Add LinkedIn data to evidence if available\n        if (linkedinData && !linkedinData.error) {\n          evidence.linkedinProfile = linkedinData;\n        }\n\n        console.log('🔥 [Research API] Calling analyze API directly...');\n        \n        // Call analyze API directly instead of HTTP fetch to avoid environment issues\n        const analyzeRequest = new NextRequest('http://localhost/api/analyze', {\n          method: 'POST',\n          headers: { 'Content-Type': 'application/json' },\n          body: JSON.stringify({ profile_id: profile.id, evidence }),\n        });\n\n        // Import and call analyze function directly\n        const { POST: analyzeHandler } = await import('../analyze/route');\n        const analysisResponse = await analyzeHandler(analyzeRequest);\n\n        if (!analysisResponse.ok) {\n          const errorText = await analysisResponse.text();\n          console.error('❌ [Research API] Analysis failed:', analysisResponse.status, errorText);\n          throw new Error(`Analysis failed: ${analysisResponse.status} ${errorText}`);\n        }\n\n        const result = await analysisResponse.json();\n        console.log('✅ [Research API] Background analysis completed successfully:', result);\n      } catch (analysisError) {\n        console.error('💥 [Research API] Background analysis failed:', analysisError);\n      }\n    })(); // Start analysis in background without waiting\n\n    console.log('✅ [Research API] Request completed successfully - analysis running in background');\n    return NextResponse.json({ \n      status: 'processing', \n      profile_id: profile.id,\n      message: 'Analysis started, results will be available shortly. Please wait for polling to complete.'\n    });\n\n  } catch (error) {\n    console.error('💥 [Research API] Unexpected error:', error);\n    console.error('📚 [Research API] Error stack:', error instanceof Error ? error.stack : 'No stack trace');\n    return NextResponse.json(\n      { error: 'Internal server error: ' + (error instanceof Error ? error.message : String(error)) }, \n      { status: 500 }\n    );\n  }\n} ","import { AppRouteRouteModule } from \"next/dist/server/route-modules/app-route/module.compiled\";\nimport { RouteKind } from \"next/dist/server/route-kind\";\nimport { patchFetch as _patchFetch } from \"next/dist/server/lib/patch-fetch\";\nimport * as userland from \"/Users/miguel/Downloads/AICareerShield/app/api/research/route.ts\";\n// We inject the nextConfigOutput here so that we can use them in the route\n// module.\nconst nextConfigOutput = \"\"\nconst routeModule = new AppRouteRouteModule({\n    definition: {\n        kind: RouteKind.APP_ROUTE,\n        page: \"/api/research/route\",\n        pathname: \"/api/research\",\n        filename: \"route\",\n        bundlePath: \"app/api/research/route\"\n    },\n    resolvedPagePath: \"/Users/miguel/Downloads/AICareerShield/app/api/research/route.ts\",\n    nextConfigOutput,\n    userland\n});\n// Pull out the exports that we need to expose from the module. This should\n// be eliminated when we've moved the other routes to the new format. These\n// are used to hook into the route.\nconst { workAsyncStorage, workUnitAsyncStorage, serverHooks } = routeModule;\nfunction patchFetch() {\n    return _patchFetch({\n        workAsyncStorage,\n        workUnitAsyncStorage\n    });\n}\nexport { routeModule, workAsyncStorage, workUnitAsyncStorage, serverHooks, patchFetch,  };\n\n//# sourceMappingURL=app-route.js.map","var _self___RSC_MANIFEST;\nimport { createServerModuleMap } from \"next/dist/server/app-render/action-utils\";\nimport { setReferenceManifestsSingleton } from \"next/dist/server/app-render/encryption-utils\";\nimport { EdgeRouteModuleWrapper } from \"next/dist/server/web/edge-route-module-wrapper\";\n// Import the userland code.\nimport * as module from \"next-app-loader?name=app%2Fapi%2Fresearch%2Froute&page=%2Fapi%2Fresearch%2Froute&pagePath=private-next-app-dir%2Fapi%2Fresearch%2Froute.ts&appDir=%2FUsers%2Fmiguel%2FDownloads%2FAICareerShield%2Fapp&appPaths=%2Fapi%2Fresearch%2Froute&pageExtensions=tsx&pageExtensions=ts&pageExtensions=jsx&pageExtensions=js&basePath=&assetPrefix=&nextConfigOutput=&preferredRegion=&middlewareConfig=e30%3D!private-next-app-dir/api/research/route.ts?__next_edge_ssr_entry__\";\nconst nextConfig = {\"env\":{},\"webpack\":null,\"eslint\":{\"ignoreDuringBuilds\":false},\"typescript\":{\"ignoreBuildErrors\":false,\"tsconfigPath\":\"tsconfig.json\"},\"distDir\":\".next\",\"cleanDistDir\":true,\"assetPrefix\":\"\",\"cacheMaxMemorySize\":52428800,\"configOrigin\":\"next.config.js\",\"useFileSystemPublicRoutes\":true,\"generateEtags\":true,\"pageExtensions\":[\"tsx\",\"ts\",\"jsx\",\"js\"],\"poweredByHeader\":true,\"compress\":true,\"images\":{\"deviceSizes\":[640,750,828,1080,1200,1920,2048,3840],\"imageSizes\":[16,32,48,64,96,128,256,384],\"path\":\"/_next/image\",\"loader\":\"default\",\"loaderFile\":\"\",\"domains\":[],\"disableStaticImages\":false,\"minimumCacheTTL\":60,\"formats\":[\"image/webp\"],\"dangerouslyAllowSVG\":false,\"contentSecurityPolicy\":\"script-src 'none'; frame-src 'none'; sandbox;\",\"contentDispositionType\":\"attachment\",\"remotePatterns\":[],\"unoptimized\":false},\"devIndicators\":{\"position\":\"bottom-left\"},\"onDemandEntries\":{\"maxInactiveAge\":60000,\"pagesBufferLength\":5},\"amp\":{\"canonicalBase\":\"\"},\"basePath\":\"\",\"sassOptions\":{},\"trailingSlash\":false,\"i18n\":null,\"productionBrowserSourceMaps\":false,\"excludeDefaultMomentLocales\":true,\"serverRuntimeConfig\":{},\"publicRuntimeConfig\":{},\"reactProductionProfiling\":false,\"reactStrictMode\":null,\"reactMaxHeadersLength\":6000,\"httpAgentOptions\":{\"keepAlive\":true},\"logging\":{},\"expireTime\":31536000,\"staticPageGenerationTimeout\":60,\"modularizeImports\":{\"@mui/icons-material\":{\"transform\":\"@mui/icons-material/{{member}}\"},\"lodash\":{\"transform\":\"lodash/{{member}}\"}},\"outputFileTracingRoot\":\"/Users/miguel/Downloads/AICareerShield\",\"experimental\":{\"nodeMiddleware\":false,\"cacheLife\":{\"default\":{\"stale\":300,\"revalidate\":900,\"expire\":4294967294},\"seconds\":{\"stale\":0,\"revalidate\":1,\"expire\":60},\"minutes\":{\"stale\":300,\"revalidate\":60,\"expire\":3600},\"hours\":{\"stale\":300,\"revalidate\":3600,\"expire\":86400},\"days\":{\"stale\":300,\"revalidate\":86400,\"expire\":604800},\"weeks\":{\"stale\":300,\"revalidate\":604800,\"expire\":2592000},\"max\":{\"stale\":300,\"revalidate\":2592000,\"expire\":4294967294}},\"cacheHandlers\":{},\"cssChunking\":true,\"multiZoneDraftMode\":false,\"appNavFailHandling\":false,\"prerenderEarlyExit\":true,\"serverMinification\":true,\"serverSourceMaps\":false,\"linkNoTouchStart\":false,\"caseSensitiveRoutes\":false,\"clientSegmentCache\":false,\"dynamicOnHover\":false,\"preloadEntriesOnStart\":true,\"clientRouterFilter\":true,\"clientRouterFilterRedirects\":false,\"fetchCacheKeyPrefix\":\"\",\"middlewarePrefetch\":\"flexible\",\"optimisticClientCache\":true,\"manualClientBasePath\":false,\"cpus\":13,\"memoryBasedWorkersCount\":false,\"imgOptConcurrency\":null,\"imgOptTimeoutInSeconds\":7,\"imgOptMaxInputPixels\":268402689,\"imgOptSequentialRead\":null,\"isrFlushToDisk\":true,\"workerThreads\":false,\"optimizeCss\":false,\"nextScriptWorkers\":false,\"scrollRestoration\":false,\"externalDir\":false,\"disableOptimizedLoading\":false,\"gzipSize\":true,\"craCompat\":false,\"esmExternals\":true,\"fullySpecified\":false,\"swcTraceProfiling\":false,\"forceSwcTransforms\":false,\"largePageDataBytes\":128000,\"typedRoutes\":false,\"typedEnv\":false,\"parallelServerCompiles\":false,\"parallelServerBuildTraces\":false,\"ppr\":false,\"authInterrupts\":false,\"webpackMemoryOptimizations\":false,\"optimizeServerReact\":true,\"useEarlyImport\":false,\"viewTransition\":false,\"routerBFCache\":false,\"staleTimes\":{\"dynamic\":0,\"static\":300},\"serverComponentsHmrCache\":true,\"staticGenerationMaxConcurrency\":8,\"staticGenerationMinPagesPerWorker\":25,\"dynamicIO\":false,\"inlineCss\":false,\"useCache\":false,\"optimizePackageImports\":[\"lucide-react\",\"date-fns\",\"lodash-es\",\"ramda\",\"antd\",\"react-bootstrap\",\"ahooks\",\"@ant-design/icons\",\"@headlessui/react\",\"@headlessui-float/react\",\"@heroicons/react/20/solid\",\"@heroicons/react/24/solid\",\"@heroicons/react/24/outline\",\"@visx/visx\",\"@tremor/react\",\"rxjs\",\"@mui/material\",\"@mui/icons-material\",\"recharts\",\"react-use\",\"effect\",\"@effect/schema\",\"@effect/platform\",\"@effect/platform-node\",\"@effect/platform-browser\",\"@effect/platform-bun\",\"@effect/sql\",\"@effect/sql-mssql\",\"@effect/sql-mysql2\",\"@effect/sql-pg\",\"@effect/sql-squlite-node\",\"@effect/sql-squlite-bun\",\"@effect/sql-squlite-wasm\",\"@effect/sql-squlite-react-native\",\"@effect/rpc\",\"@effect/rpc-http\",\"@effect/typeclass\",\"@effect/experimental\",\"@effect/opentelemetry\",\"@material-ui/core\",\"@material-ui/icons\",\"@tabler/icons-react\",\"mui-core\",\"react-icons/ai\",\"react-icons/bi\",\"react-icons/bs\",\"react-icons/cg\",\"react-icons/ci\",\"react-icons/di\",\"react-icons/fa\",\"react-icons/fa6\",\"react-icons/fc\",\"react-icons/fi\",\"react-icons/gi\",\"react-icons/go\",\"react-icons/gr\",\"react-icons/hi\",\"react-icons/hi2\",\"react-icons/im\",\"react-icons/io\",\"react-icons/io5\",\"react-icons/lia\",\"react-icons/lib\",\"react-icons/lu\",\"react-icons/md\",\"react-icons/pi\",\"react-icons/ri\",\"react-icons/rx\",\"react-icons/si\",\"react-icons/sl\",\"react-icons/tb\",\"react-icons/tfi\",\"react-icons/ti\",\"react-icons/vsc\",\"react-icons/wi\"]},\"htmlLimitedBots\":\"Mediapartners-Google|Slurp|DuckDuckBot|baiduspider|yandex|sogou|bitlybot|tumblr|vkShare|quora link preview|redditbot|ia_archiver|Bingbot|BingPreview|applebot|facebookexternalhit|facebookcatalog|Twitterbot|LinkedInBot|Slackbot|Discordbot|WhatsApp|SkypeUriPreview|Yeti\",\"bundlePagesRouterDependencies\":false,\"configFile\":\"/Users/miguel/Downloads/AICareerShield/next.config.js\",\"configFileName\":\"next.config.js\",\"serverExternalPackages\":[\"pdf-parse\"],\"turbopack\":{\"root\":\"/Users/miguel/Downloads/AICareerShield\"}}\nconst maybeJSONParse = (str)=>str ? JSON.parse(str) : undefined;\nconst rscManifest = (_self___RSC_MANIFEST = self.__RSC_MANIFEST) == null ? void 0 : _self___RSC_MANIFEST[\"/api/research/route\"];\nconst rscServerManifest = maybeJSONParse(self.__RSC_SERVER_MANIFEST);\nif (rscManifest && rscServerManifest) {\n    setReferenceManifestsSingleton({\n        page: \"/api/research/route\",\n        clientReferenceManifest: rscManifest,\n        serverActionsManifest: rscServerManifest,\n        serverModuleMap: createServerModuleMap({\n            serverActionsManifest: rscServerManifest\n        })\n    });\n}\nexport const ComponentMod = module;\nexport default EdgeRouteModuleWrapper.wrap(module.routeModule, {\n    nextConfig\n});\n\n//# sourceMappingURL=edge-app-route.js.map","module.exports = require(\"node:buffer\");","module.exports = require(\"node:async_hooks\");"],"names":["runtime","maxDuration","sanitizeText","text","normalize","replace","JSON","parse","match","substring","extractJSON","responseContent","context","console","log","directParsed","directError","codeBlockMatches","block","jsonContent","trim","parsed","blockError","jsonMatches","sort","sortedMatches","a","b","length","matchError","cleanedContent","startsWith","endsWith","cleanError","fixedMatches","fixError","error","analyzeLinkedInProfile","openai","linkedinUrl","responses","create","model","tools","input","role","content","type","output_text","extractedData","Error","reason","message","processUploadedFile","fileContent","fileName","fileType","includes","response","Promise","race","_","reject","setTimeout","extendedError","POST","req","userId","sessionId","auth","hasSession","body","json","stringify","tasks","resume","profileData","uploadedFile","NextResponse","status","sanitizedRole","sanitizedResume","supabase","createClient","process","env","SUPABASE_URL","SUPABASE_SERVICE_ROLE_KEY","OpenAI","apiKey","OPENAI_API_KEY","timeout","name","processedFileContent","fileError","linkedinData","dailyTasks","skills","Array","isArray","join","careerProgression","linkedinError","data","profile","dbError","from","insert","task_hours","email","user_id","profile_data","careerCategory","yearsExperience","companySize","dailyWorkSummary","keySkills","linkedin_data","select","single","prompt","researchPrompt","research","evidence","linkedinProfile","analyzeRequest","NextRequest","method","headers","profile_id","id","analyzeHandler","analysisResponse","ok","errorText","result","analysisError","stack","String"],"sourceRoot":"","ignoreList":[]}